<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Lautgetreue W√∂rter ‚Äì H√∂r gut zu und schreibe!</title>
<style>
  :root {
    font-family: "Comic Sans MS", "Segoe UI", sans-serif;
    background: #eef2ff;
  }
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .app {
    background: #ffffff;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    padding: 2rem 2.5rem;
    max-width: 620px;
    width: 100%;
    box-sizing: border-box;
    text-align: center;
  }
  h1 {
    margin-top: 0;
    font-size: 1.8rem;
  }
  .word {
    font-family: "Comic Sans MS", sans-serif;
    font-size: 3.6rem;
    letter-spacing: 0.15em;
    margin: 1rem 0;
  }
  .letters {
    margin-top: 1.4rem;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: .5rem;
  }
  .letter-btn {
    font-family: "Comic Sans MS", sans-serif;
    padding: 0.7rem;
    border-radius: 10px;
    background: #e0e7ff;
    border: 2px solid #c7d2fe;
    cursor: pointer;
    font-size: 1.6rem;
    font-weight: bold;
  }
  .letter-btn:hover { background:#c7d2fe; }
  .letter-btn:disabled {
    opacity: .5;
    cursor: default;
  }
  .feedback {
    min-height: 1.4rem;
    font-size: 1.2rem;
    margin-top: .8rem;
    font-weight: 600;
  }
  .ok { color:#15803d; }
  .err { color:#b91c1c; }
  #finish-btn {
    margin-top: 1.2rem;
    padding: .8rem 1rem;
    font-size: 1.2rem;
    border-radius: 12px;
    cursor: pointer;
    border: none;
    background: #22c55e;
    color: #fff;
    font-weight: 600;
  }
  #finish-btn:disabled {
    background:#9ca3af;
    cursor:not-allowed;
  }
  .hidden { display:none; }
  #speak-btn {
    padding:0.6rem 1rem;
    font-size:1rem;
    border-radius:10px;
    cursor:pointer;
    border:1px solid #c7d2fe;
    background:#eef2ff;
  }
  #speak-btn:hover { background:#e0e7ff; }
</style>
</head>
<body>

<div class="app">
  <h1>H√∂r gut zu und schreibe!</h1>
  <p id="instruction">H√∂r gut zu und schreibe, was du h√∂rst.</p>

  <div class="word" id="word-display">_</div>

  <button id="speak-btn">üîä Noch einmal h√∂ren</button>

  <div class="letters" id="letters"></div>

  <div class="feedback" id="feedback"></div>

  <button id="finish-btn" class="hidden">Fertig ‚úî</button>
</div>

<script>
/* --------- Laut-Einheiten (Buchstaben + Diphthonge) --------- */
const MULTI_GRAPHEMES = ["au", "ei", "eu", "√§u"];

/* Einheiten, aus denen die Antwort-Buttons gezogen werden:
   ‚Äì Einzelbuchstaben
   ‚Äì Diphthonge wie au, ei, eu, √§u */
const LETTER_UNITS = [
  "a","e","i","o","u","√§","√∂","√º",
  "b","d","f","g","h","k","l","m","n","p",
  "r","s","t","w","z",
  "au","ei","eu","√§u"
];

/* --------- Lautgetreue W√∂rter (nur Tiere & Alltag, keine ie/eh/doppelten Buchstaben) --------- */
/* alle klein gespeichert, Anzeige mit Gro√übuchstaben am Wortanfang */
const WORDS = [
  "baum","haus","maus","frau","auto","eule","feuer","laus","haut",
  "lama","tiger","zebra","panda","dachs","biber","wal","rabe","ente","gans",
  "ente","ente","kuh","kater","katze","hund","hahn","hase","ente","eber",
  "sofa","stuhl","tisch","bett","tuch","uhr","tor","zaun","zaum","korb",
  "hose","rock","hut","hemd","m√ºtze","mantel","jacke","schuh","hose","gurt",
  "brot","apfel","birne","banane","traube","keks","kuchen","salat","pizza","saft",
  "bus","zug","bahn","boot","rad","taxi","auto","tram","weg","br√ºcke",
  "park","wald","wiese","see","teich","bach","strand","sand","ufer","hafen",
  "kind","mama","papa","oma","opa","onkel","tante","freund","gruppe","team"
];

/* Du kannst hier jederzeit W√∂rter austauschen/erg√§nzen. Achte darauf:
   ‚Äì keine ‚Äûie‚Äú, ‚Äûeh‚Äú usw.
   ‚Äì keine doppelten Buchstaben wie ‚Äûmm‚Äú, ‚Äûtt‚Äú etc.
   ‚Äì Diphthonge au/ei/eu/√§u sind erlaubt und werden als Einheit behandelt. */

/* --------- Variablen --------- */
let correctCount = 0;
const TARGET = 20;

let currentWord = "";
let missingStart = 0;
let missingLen = 1;
let correctUnit = "";

let freeze = false; // w√§hrend der 5s-Lesepause keine Eingabe

/* --------- DOM-Referenzen --------- */
const wordDisplay = document.getElementById("word-display");
const lettersDiv   = document.getElementById("letters");
const feedback     = document.getElementById("feedback");
const speakBtn     = document.getElementById("speak-btn");
const finishBtn    = document.getElementById("finish-btn");

/* --------- Sprachausgabe --------- */
function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang  = "de-DE";
  utter.rate  = 0.7; // langsam
  speechSynthesis.speak(utter);
}

/* Arbeitsauftrag automatisch vorlesen */
setTimeout(() => {
  speak("H√∂r gut zu und schreibe, was du h√∂rst.");
}, 800);

/* --------- Hilfsfunktionen --------- */
function pickRandomWord() {
  return WORDS[Math.floor(Math.random() * WORDS.length)];
}

/* Wort in Laut-Einheiten zerlegen (Buchstaben + Diphthonge) */
function segmentWord(word) {
  const segments = [];
  for (let i = 0; i < word.length; ) {
    let two = word.slice(i, i + 2);
    if (MULTI_GRAPHEMES.includes(two)) {
      segments.push({ start: i, len: 2, text: two });
      i += 2;
    } else {
      segments.push({ start: i, len: 1, text: word[i] });
      i += 1;
    }
  }
  return segments;
}

/* Anzeige mit L√ºcke im fehlenden Laut */
function buildDisplayWithGap(word, start, len) {
  let result = "";
  for (let i = 0; i < word.length; ) {
    if (i === start) {
      // ein Unterstrich f√ºr die Laut-L√ºcke
      let ch = "_";
      if (i === 0) {
        // Wortanfang: Unterstrich bleibt Unterstrich
        result += ch;
      } else {
        result += ch;
      }
      i += len;
    } else {
      let ch = word[i];
      if (i === 0) ch = ch.toUpperCase();
      result += ch;
      i += 1;
    }
  }
  return result;
}

/* Anzeige mit richtigem Laut in Gr√ºn */
function buildDisplayWithHighlight(word, start, len) {
  let html = "";
  for (let i = 0; i < word.length; ) {
    if (i === start) {
      let unit = word.slice(i, i + len);
      if (i === 0) {
        unit = unit.charAt(0).toUpperCase() + unit.slice(1);
      }
      html += `<span style="color:#16a34a;">${unit}</span>`;
      i += len;
    } else {
      let ch = word[i];
      if (i === 0) ch = ch.toUpperCase();
      html += ch;
      i += 1;
    }
  }
  return html;
}

/* --------- Neues Wort erzeugen --------- */
function newWord() {
  freeze = false;
  feedback.textContent = "";
  feedback.className   = "feedback";

  currentWord  = pickRandomWord();
  const segments = segmentWord(currentWord);

  // Einen Laut (Segment) als L√ºcke ausw√§hlen
  const seg = segments[Math.floor(Math.random() * segments.length)];
  missingStart = seg.start;
  missingLen   = seg.len;
  correctUnit  = seg.text;

  // Wort mit L√ºcke anzeigen
  const display = buildDisplayWithGap(currentWord, missingStart, missingLen);
  wordDisplay.textContent = display;

  // Wort vorlesen (mit Gro√übuchstabe)
  const spoken = currentWord.charAt(0).toUpperCase() + currentWord.slice(1);
  speak(spoken);

  generateLetterButtons();
}

/* --------- Buchstaben-/Laut-Auswahl erzeugen --------- */
function generateLetterButtons() {
  lettersDiv.innerHTML = "";

  let options = [correctUnit];

  // F√ºlle mit zuf√§lligen Einheiten auf (Einzelbuchstabe oder Diphthong)
  while (options.length < 6) {
    const unit = LETTER_UNITS[Math.floor(Math.random() * LETTER_UNITS.length)];
    if (!options.includes(unit)) {
      options.push(unit);
    }
  }

  // mischen
  options.sort(() => Math.random() - 0.5);

  options.forEach(unit => {
    const btn = document.createElement("button");
    btn.className = "letter-btn";
    btn.textContent = unit;
    btn.onclick = () => {
      if (freeze) return;
      handleChoice(unit, btn);
    };
    lettersDiv.appendChild(btn);
  });
}

/* --------- Eingabe behandeln --------- */
function handleChoice(unit, btn) {
  if (unit === correctUnit) {
    correctCount++;
    feedback.textContent = "Richtig! üëç Lies das Wort.";
    feedback.classList.add("ok");

    // Alle Buttons deaktivieren w√§hrend der Lese-Pause
    freezeButtons();

    // Vollst√§ndiges Wort mit gr√ºnem Laut anzeigen
    const html = buildDisplayWithHighlight(currentWord, missingStart, missingLen);
    wordDisplay.innerHTML = html;

    // Wort nochmal vorlesen
    const spoken = currentWord.charAt(0).toUpperCase() + currentWord.slice(1);
    speak(spoken);

    freeze = true;

    if (correctCount >= TARGET) {
      // Letztes Wort noch 5 Sekunden lesen lassen, dann Spielende
      setTimeout(() => {
        endGame();
      }, 5000);
    } else {
      // 5 Sekunden Lesepause, dann neues Wort
      setTimeout(() => {
        newWord();
      }, 5000);
    }

  } else {
    // falscher Laut ‚Üí Button verschwindet
    btn.remove();
  }
}

function freezeButtons() {
  const all = lettersDiv.querySelectorAll("button");
  all.forEach(b => b.disabled = true);
}

/* --------- Spielende --------- */
function endGame() {
  wordDisplay.textContent = "Super gemacht!";
  lettersDiv.innerHTML = "";
  speak("Sehr gut! Du hast viele W√∂rter richtig geh√∂rt und gelesen.");
  finishBtn.classList.remove("hidden");

  finishBtn.onclick = () => {
    try {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage("AppSolved", "*");
      }
    } catch (e) {}
    finishBtn.textContent = "Erledigt ‚úî";
    finishBtn.disabled = true;
  };
}

/* --------- Buttons --------- */
speakBtn.onclick = () => {
  if (!currentWord || freeze) return;
  const spoken = currentWord.charAt(0).toUpperCase() + currentWord.slice(1);
  speak(spoken);
};

/* --------- Start --------- */
newWord();
</script>

</body>
</html>
